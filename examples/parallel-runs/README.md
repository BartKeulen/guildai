# Guild Example: `parallel-runs`

This example documents how you can run operations in parallel.

- [guild.yml](guild.yml) - Project Guild file
- [sleep.py](sleep.py) - Sample operation

Operations:

- `op` - sample operation - sleeps for a period of time
- `steps` - sample stepped operation - calls `op` multiple times

## Run Operations in Background

Use the `--background` option to run an operation in the
background. You can start as many runs as you want this way.

For example, to start three `op` runs in the background, run:

    $ guild run op --background
    $ guild run op --background
    $ guild run op --background

Start stepped operations in the same way:

    $ guild run steps --background
    $ guild run steps --background

Check the status of runs using `guild runs`.

    $ guild runs

Filter by status using filter options. For example, to show only
running operations:

    $ guild runs --running

## Use Queues to Control Concurrency

Queues are operations that start staged runs. Use queues to control
the level of concurrency on a system.

To see how a queue works, start one in the background:

    $ guild run queue --background

The queue waits for staged runs.

Stage `op`:

    $ guild run op --stage

Use the `watch` command to watch the queue output:

    $ guild watch -o queue

You see the output generated by the `queue` operation. Note that it
starts the staged `op` run.

Type `Ctrl-c` to exit `watch`.

Start another queue in the background:

    $ guild run queue --background

Now you have two queues. Each queue waits to staged runs and starts
them. Because each queue runs in a separate process, staged operations
run concurrently. You control the number of concurrent runs by the
number of queues.

Stage two `steps` operations:

    $ guild run steps --stage
    $ guild run steps --stage

Show running operations:

    $ guild runs --running

Repeat this command until the started runs have completed.
